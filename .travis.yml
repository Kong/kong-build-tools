dist: xenial
language: python
python:
  - "3.6"

env:
  global:
    - KONG_SOURCE_LOCATION=/tmp/kong
    - HELM_VERSION=v2.11.0
    - EDITION=community
    - KONG_PACKAGE_NAME=kong
    - KONG_CONFLICTS=kong-enterprise
    - KONG_LICENSE="ASL 2.0"
    - DOCKER_BUILDKIT=1
    - DOCKER_MACHINE_ARM64_NAME=travis-ci-kong-build-tools-${TRAVIS_JOB_ID}
  matrix:
    - CACHE=false PACKAGE_TYPE=deb RESTY_IMAGE_BASE=ubuntu RESTY_IMAGE_TAG=xenial KONG_SOURCE=next

before_script:
  - make setup-ci
  - git clone --single-branch --branch ${KONG_SOURCE} https://github.com/Kong/kong.git ${KONG_SOURCE_LOCATION}

script:
  - make build-kong
  - export KUBECONFIG="$(kind get kubeconfig-path --name="kind")"
  - make test

after_script:
  - make cleanup_build

