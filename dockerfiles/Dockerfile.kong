ARG PACKAGE_TYPE
ARG DOCKER_OPENRESTY_SUFFIX
ARG DOCKER_REPOSITORY

ARG GITHUB_TOKEN=

FROM ${DOCKER_REPOSITORY}:openresty-${PACKAGE_TYPE}-${DOCKER_OPENRESTY_SUFFIX}

ENV GITHUB_TOKEN $GITHUB_TOKEN

COPY kong /kong
RUN rm -rf /distribution/*

COPY kong/.requirements kong/distribution/ /distribution/
WORKDIR /distribution
RUN if [ -f "/distribution/post-install.sh" ] ; then ./post-install.sh; fi

WORKDIR /kong
COPY build-kong.sh /build-kong.sh
RUN /build-kong.sh
